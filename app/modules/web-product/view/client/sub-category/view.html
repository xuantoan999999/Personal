<div id="mod-category" class="module" data-module="category" ng-controller="categoryCtrl as vmCategory">
    <div class="container">
        <div class="banner">
            <img src="{{ linkAssets 'frontend/images/banner-top.png' }}" class="img-responsive">
        </div>
        <div class="row">
            <!--Start: Left Sidebar-->
            <div class="col-xs-4 col-left">
                <!--Start: List category-->
                <div class="vegetables">
                    <h3>{{data.parrentCategory.name}}</h3>
                    <ul class="list-menu">
                        {{#each data.categories.sub_category}}
                        <!--class="active" -->
                        <li class="{{#if_eq this.category.slug ../data.category.slug}} active {{/if_eq}} {{#if_eq this.category.slug ../data.category.parent_category.slug}} active {{/if_eq}}">
                            <b class="is-open"></b>
                            <a href="/danh-muc/{{../data.parrentCategory.slug}}/{{this.category.slug}}" class="{{#if_eq this.category.slug ../data.category.slug}} active {{/if_eq}}">
                                <span>{{this.category.name}}</span>
                                <span>({{this.product_count}})</span>
                            </a>
                            {{#if this.sub_category}}
                            <ul>
                                {{#each this.sub_category}}
                                <!--class="active"-->
                                <li>
                                    <a href="/danh-muc/{{../../data.parrentCategory.slug}}/{{this.category.slug}}" class="{{#if_eq this.category.slug ../../data.category.slug}} active {{/if_eq}}">{{this.category.name}} <span>({{this.product_count}})</span></a>
                                </li>
                                {{/each}}
                            </ul>
                            {{/if}}
                        </li>
                        {{/each}}
                    </ul>
                </div>
                <!--End: List category-->

                <!--Start: List cooking-->
                <div class="cooking">
                    <h3>Cách nấu thông dụng </h3>
                    {{#each data.tag_processing}}
                    <div class="form-group">
                        <label role="checkbox" for="{{this._id}}">
                            <input type="checkbox" id="{{this._id}}" ng-model="tagProcessings['{{this._id}}']" value="{{this._id}}">{{this.name}} <i></i>
                            <span ng-bind="'(' + data.tag_processing[{{@index}}].count + ')'"></span>
                        </label>
                    </div>
                    {{/each}}
                </div>
                <!--End: List cooking-->
            </div>
            <!--End: Left Sidebar-->

            <!--Start: Right content-->
            <div class="col-xs-20 col-right">
                <!--Start : Tree link-->
                <div class="tree-link">
                    <a href="/">Trang chủ</a>
                    <span>></span>
                    <a href="/danh-muc/{{data.parrentCategory.slug}}">
                        {{data.parrentCategory.name}}
                    </a>
                    <span>></span>
                    <a href="/danh-muc/{{data.parrentCategory.slug}}/{{data.category.slug}}">
                        {{data.category.name}}
                    </a>
                </div>
                <!--End: Tree link-->

                <!--Start: List Category-->
                {{#if data.same_category}}
                <div class="filter-proc row">
                    {{#each data.same_category}}
                    <div class="choose-filter col-xs-4">
                        <a href="/danh-muc/{{../data.parrentCategory.slug}}/{{this.category.slug}}" class="btn">
                            <img src="/files/category_image/{{this.category.images.[0].url}}" alt="">
                            <span class="name-cate">
                                {{this.category.name}} <span class="sl">({{this.product_count}})</span>
                            </span>
                        </a>
                    </div>
                    {{/each}}
                    <div class="clearfix"></div>
                </div>
                {{/if}}
                <!--End: List Category-->

                <!--Start: Content-->
                <div class="search-result">
                    <!--Start: Top menu-->
                    <h1>
                        {{data.category.name}} 
                        <span class="many-proc">
                            ( {{data.products.length}} sản phẩm)
                        </span>
                    </h1>
                    <div class="form-group">
                        <div class="filter">
                            <select ng-model="sort_tag" class="selectbox" ng-change="sortTag()">
                                {{#each data.tag_product}}
								<option value="{{this._id}}">{{this.name}}</option>
                                {{/each}}
							</select>
                        </div>
                    </div>
                    <!--End: Top menu-->

                    <!--Start: List product-->
                    <div class="products row hidden" id="product-list">
                        <div class="col-xs-6" ng-repeat="product in products_list | productTag : tagProcessings">
                            <div class="proc">
                                <div class="image" style="background: url('/files/product_image/[[product.images[0].url]]') top center no-repeat; cursor: pointer;" ng-click="popupDetail(product.slug, product._id)">
                                    <img ng-src="/files/product_image/[[product.images[0].url]]" class='img-responsive'>
                                    <span class="sale-code" ng-if="product.id_promotion">
                                        Giảm giá [[product.promotion.value]]
                                        <span ng-switch="product.promotion.type">
                                            <span ng-switch-when="MN">Đ</span>
                                            <span ng-switch-when="PC">%</span>
                                        </span>
                                    </span>
                                </div>

                                <div class="info">
                                    <div class="text">
                                        <a class="name" ng-bind="product.name" href="" ng-click="popupDetail(product.slug, product._id)"></a>
                                        <p class="weight">[[product.view_unit]]</p>
                                    </div>
                                </div>

                                <div class="button">
                                    <div class="prices" ng-show="product.id_promotion">
                                        <span class="price-old show-desktop">
                                            [[product.price]] <span class="dv">đ</span>
                                        </span>
                                        <span class="price">
                                            <span ng-switch="product.promotion.type">
                                                <span ng-switch-when='PC' ng-bind="product.price * (100 - product.promotion.value) / 100"></span>
                                                <span ng-switch-when='MN' ng-bind="product.price - product.promotion.value"></span>
                                            </span>
                                            <span class="dv">đ</span>
                                        </span>
                                        <span class="price-old show-mb">
                                            [[product.price]] <span class="dv">đ</span>
                                        </span>
                                    </div>

                                    <div class="prices" ng-show="!product.id_promotion">
                                        <span class="price">
                                            [[product.price]] 
                                            <span class="dv">đ</span>
                                        </span>
                                    </div>

                                    <div class="take-cart" ng-if="product.qty_in_stock > 0">
                                        <button class="btn btn-primary" ng-show="!product.cart" ng-click="addToCart(product._id)">
                                            Bỏ vào giỏ
                                        </button>
                                        <div class="soluong show" ng-show="product.cart">
                                            <img src="{{ linkAssets 'frontend/images/icon-giam.svg' }}" class="img-reponsive" ng-click="decreaseCart(product._id,product.cart.quantity)">
                                            <span ng-bind="product.cart.quantity"></span>
                                            <img src="{{ linkAssets 'frontend/images/icon-tang.png' }}" alt="" class="img-responsive" ng-click="addToCart(product._id)">
                                        </div>
                                    </div>

                                    <div class="take-cart" ng-if="product.qty_in_stock == 0">
                                        <button class="btn btn-primary" disabled>Sắp có hàng</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--End: List product-->
                </div>
                <!--End: Content-->
            </div>
            <!--End: Right content-->
        </div>
        <div class="button"></div>
    </div>
</div>

<script>
    var data = {{{json data}}};
</script>